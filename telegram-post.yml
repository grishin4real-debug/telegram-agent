name: Telegram Channel Auto-Post

# –ó–∞–ø—É—Å–∫ workflow –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
on:
  schedule:
    # –ó–∞–ø—É—Å–∫–∞—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 07:00 UTC (10:00 –ú–°–ö)
    # –°–∫—Ä–∏–ø—Ç post_once.py —Å–∞–º –ø—Ä–æ–≤–µ—Ä–∏—Ç, –ø—Ä–æ—à–ª–æ –ª–∏ 3 –¥–Ω—è —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
    - cron: '0 7 * * *'
  
  # –¢–∞–∫–∂–µ —Ä–∞–∑—Ä–µ—à–∏—Ç—å —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å GitHub
  workflow_dispatch:

jobs:
  post-to-telegram:
    runs-on: ubuntu-latest
    
    steps:
    # –®–∞–≥ 1: Checkout –∫–æ–¥–∞ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
    - name: Checkout –∫–æ–¥
      uses: actions/checkout@v4
      with:
        # –ù—É–∂–µ–Ω —Ç–æ–∫–µ–Ω –¥–ª—è –∫–æ–º–º–∏—Ç–∞ —Ñ–∞–π–ª–∞ last_post.txt –æ–±—Ä–∞—Ç–Ω–æ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
        token: ${{ secrets.GITHUB_TOKEN }}
    
    # –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Python
    - name: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    # –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    - name: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt
    
    # –®–∞–≥ 4: –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ—Å—Ç–∞
    - name: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ—Å—Ç–∞
      env:
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHANNEL_ID: ${{ secrets.TELEGRAM_CHANNEL_ID }}
      run: |
        python post_once.py
    
    # –®–∞–≥ 5: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ last_post.txt –æ–±—Ä–∞—Ç–Ω–æ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
    - name: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞—Ç—ã –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
      if: success()
      run: |
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git config --local user.name "GitHub Actions Bot"
        git add last_post.txt
        git diff --quiet && git diff --staged --quiet || git commit -m "üìÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏"
        git push